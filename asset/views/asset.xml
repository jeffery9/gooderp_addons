<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!--固定资产tree-->
		<record id='asset_tree' model='ir.ui.view'>
			<field name='name'>asset.tree</field>
			<field name='model'>asset</field>
			<field name='arch' type='xml'>
				<tree string='固定资产'>
                    <field name='code'/>
					<field name='name'/>
                    <field name='category_id'/>
					<field name='cost'/>
                    <field name='net_value' sum='净值合计'/>
                    <field name="cost_depreciation" sum='每月折旧合计'/>
                    <field name='state'/>
				</tree>
			</field>
		</record>

        <!--固定资产处置/清查-->
        <record id="create_clean_wizard_form" model="ir.ui.view">
            <field name="name">create.clean.wizard</field>
            <field name="model">create.clean.wizard</field>
            <field name="arch" type="xml">
            	<form>
                    <group>
                        <field name="date"/>
                        <field name="period_id"/>
                        <field name="clean_type"/>
                        <field name="clean_account" attrs="{'required':[('clean_type', '!=', 'handle')], 'invisible': [('clean_type', '=', 'handle')]}" options="{'no_open': True, 'no_create': True}"/>
                        <group>
                            <field name="clean_cost" attrs="{'required':[('clean_type', '=', 'handle')], 'invisible': [('clean_type', '!=', 'handle')]}"/>
                            <field name="cost_select" attrs="{'required':['&amp;',('clean_type', '=', 'handle'),('clean_cost', '&gt;', 0)], 'invisible': ['|',('clean_type', '!=', 'handle'),('clean_cost', '&lt;=', 0)]}"/>
                            <field name="cost_bank" attrs="{'required':['&amp;','&amp;',('clean_type', '=', 'handle'),('clean_cost', '&gt;', 0),('cost_select', '=', 'bank')], 'invisible': ['|','|',('clean_type', '!=', 'handle'),('clean_cost', '&lt;=', 0),('cost_select', '!=', 'bank')]}"/>
                            <field name="cost_account" attrs="{'required':['&amp;','&amp;',('clean_type', '=', 'handle'),('clean_cost', '&gt;', 0),('cost_select', '=', 'account')], 'invisible': ['|','|',('clean_type', '!=', 'handle'),('clean_cost', '&lt;=', 0),('cost_select', '!=', 'account')]}"
                            options="{'no_open': True, 'no_create': True}"/>
                        </group>
                        <group>
                            <field name="residual_income" attrs="{'required':[('clean_type', '=', 'handle')], 'invisible': [('clean_type', '!=', 'handle')]}"/>
                            <field name="income_select" attrs="{'required':['&amp;',('clean_type', '=', 'handle'),('residual_income', '&gt;', 0)], 'invisible': ['|',('clean_type', '!=', 'handle'),('residual_income', '&lt;=', 0)]}"/>
                            <field name="income_bank" attrs="{'required':['&amp;','&amp;',('clean_type', '=', 'handle'),('residual_income', '&gt;', 0),('income_select', '=', 'bank')], 'invisible': ['|','|',('clean_type', '!=', 'handle'),('residual_income', '&lt;=', 0),('income_select', '!=', 'bank')]}"/>
                            <field name="income_account" attrs="{'required':['&amp;','&amp;',('clean_type', '=', 'handle'),('residual_income', '&gt;', 0),('income_select', '=', 'account')], 'invisible': ['|','|',('clean_type', '!=', 'handle'),('residual_income', '&lt;=', 0),('income_select', '!=', 'account')]}" options="{'no_open': True, 'no_create': True}"/>
                            <field name="sell_tax_amount" attrs="{'required':[('clean_type', '=', 'handle')], 'invisible': [('clean_type', '!=', 'handle')]}"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_clean_account"  string="生成处置凭证" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>

        <!--固定资产变更-->
        <record id="create_chang_wizard_form" model="ir.ui.view">
            <field name="name">create.chang.wizard</field>
            <field name="model">create.chang.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="chang_date"/>
                            <field name="period_id"/>
                            <field name="chang_cost"/>
                            <field name="chang_depreciation_number"/>
                            <field name="chang_tax"/>
                            <field name="chang_partner_id" domain="[('s_category_id', '!=', False)]" context="{'form_view_ref': 'core.supplier_address_form'}"/>
                        </group>
                        <group>
                            <field name="change_reason" required="1"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_chang_account"  string="生成变更凭证" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>

        <!--固定资产确认-->
        <record id="create_asset_wizard_form" model="ir.ui.view">
            <field name="name">create.asset.wizard.form</field>
            <field name="model">create.asset.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="create_type"/>
                            <field name="account_ids" invisible="1"/>
                            <!--过滤科目，客户后来不想要的，所以使用了NOT IN如需要使用则改为in-->
                            <field name="account_credit" domain="[('id', 'not in', account_ids)]"
                                    attrs="{'required':[('create_type', '=', 'account')], 'invisible': [('create_type', '!=', 'account')]}"                                               options="{'no_open': True, 'no_create': True}"/>/>
                            <field name="partner_id"
                                   domain="[('s_category_id', '!=', False)]" context="{'form_view_ref': 'core.supplier_address_form'}"
                                   attrs="{'required':[('create_type', '=', 'partner')], 'invisible': [('create_type', '!=', 'partner')]}"/>
                            <field name="bank_account"
                                    attrs="{'required':[('create_type', '=', 'bank')], 'invisible': [('create_type', '!=', 'bank')]}"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_asset"  string="生成对应单据/凭证" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>
        
        <!-- form view在此前定义，后面的form view引用了这两个action，所以不能把它们放在action文件里 -->
        <!-- 固定资产处置/清查 action -->
        <record id="create_clean_action" model="ir.actions.act_window">
            <field name="name">固定资产处置/清查</field>
            <field name="res_model">create.clean.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="create_clean_wizard_form"/>
            <field name="target">new</field>
            <field name="multi">True</field>
        </record>
        <!-- 固定资产变更 action -->
        <record id="create_chang_action" model="ir.actions.act_window">
            <field name="name">固定资产变更</field>
            <field name="res_model">create.chang.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="create_chang_wizard_form"/>
            <field name="target">new</field>
            <field name="multi">True</field>
        </record>
        <!-- 固定资产确认 action -->
        <record id="create_asset_action" model="ir.actions.act_window">
            <field name="name">固定资产确认</field>
            <field name="res_model">create.asset.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="create_asset_wizard_form"/>
            <field name="target">new</field>
            <field name="multi">True</field>
        </record>

		<!--固定资产 Form-->
        <record id='asset_form' model='ir.ui.view'>
			<field name='name'>asset.form</field>
			<field name='model'>asset</field>
			<field name='arch' type='xml'>
                <form string="固定资产">
	                <header>
	                	<button name="%(create_asset_action)d" string="确认" type="action" class="oe_highlight" attrs="{'invisible': ['|',('is_init', '!=', False),('state', '!=', 'draft')]}"/>
                        <button name="asset_done" string="确认" type="object" class="oe_highlight" attrs="{'invisible': ['|',('is_init', '!=', True),('state', '!=', 'draft')]}"/>
	                	<button name='asset_draft' states="done" string="撤销确认" type="object" />
                        <button name="%(create_clean_action)d" string="处置/清查固定资产" type="action" class="btn-primary"
                        attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        <button name="%(create_chang_action)d" string="变更固定资产" type="action" class="btn-primary"
                        attrs="{'invisible': [('state', '!=', 'done')]}"/>
	                    <field name="state" widget="statusbar" readonly="1"/>
	                </header>
			    	<sheet>
                        <group>
                            <group>
                                <field name='code'/>
                                <field name="name"/>
                                <field name="category_id"/>
                                <field name="cost"/>
                                <field name="surplus_value"/>
                            </group>
                            <group>
                                <field name="net_value"/>
                                <field name="forever_no_depreciation" invisible = '1'/>
                                <field name="no_depreciation" attrs="{'invisible': [('forever_no_depreciation', '=', True)]}"/>
                                <field name="depreciation_number" attrs="{'invisible': [('forever_no_depreciation', '=', True)]}"/>
                                <field name="depreciation_value" attrs="{'invisible': [('forever_no_depreciation', '=', True)]}"/>
                                <field name="cost_depreciation" attrs="{'invisible': [('forever_no_depreciation', '=', True)]}"/>

                            </group>
                        </group>
                        <notebook>
                            <page string="入账">
                              <group>
                              <group>
                                <field name="period_id"/>
                                <field name="date"/>
                                <field name="tax"/>
                                <field name="amount"/>
                                <field name="is_init" groups='core.master_groups'/>
                                <field name="depreciation_previous" attrs="{'invisible': [('is_init', '=', False)]}" />
                              </group>
                              <group>

                                <field name="account_asset" options="{'no_open': True, 'no_create': True}"/>
                                <field name="account_depreciation" attrs="{'required':[('forever_no_depreciation', '=', False)], 'invisible': [('forever_no_depreciation', '!=', False)]}" options="{'no_open': True, 'no_create': True}"/>
                                <field name="account_accumulated_depreciation" attrs="{'required':[('forever_no_depreciation', '=', False)], 'invisible': [('forever_no_depreciation', '!=', False)]}" options="{'no_open': True, 'no_create': True}"/>
                              </group>
                              </group>
                            </page>
                            <page string="折旧">
                                <field name="line_ids">
                                     <tree string="折旧行" editable="bottom" create='0'>
                                         <field name="date"/>
                                         <field name="period_id"/>
                                         <field name="cost_depreciation" sum="合计折旧"/>
                                     </tree>
                                </field>
                            </page>
                            <page string="变更">
                                 <field name="chang_ids">
                                      <tree string="变更明细" editable="bottom" create='0'>
                                          <field name="date"/>
                                          <field name="period_id"/>
                                          <field name="chang_name"/>
                                          <field name="chang_before"/>
                                          <field name="chang_after"/>
                                          <field name="partner_id"/>
                                          <field name="change_reason"/>
                                          <field name="create_uid" string="变更人"/>
                                      </tree>
                                 </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
			</field>
		</record>

		<!--固定资产折旧明细-->
        <record id='asset_line_tree' model='ir.ui.view'>
			<field name='name'>asset.line.tree</field>
			<field name='model'>asset.line</field>
			<field name='arch' type='xml'>
				<tree string='固定资产折旧明细' create='0' delete='0'>
                    <field name='code'/>
					<field name='name'/>
					<field name='period_id'/>
					<field name='cost_depreciation' string="本期折旧额"/>
					<field name='no_depreciation'/>
				</tree>
			</field>
		</record>

        <record id="asset_line_tree_filter" model="ir.ui.view">
            <field name="name">asset.line.select</field>
            <field name="model">asset.line</field>
            <field name="arch" type="xml">
                <search string="固定资产折旧分类">
                    <field name="period_id"/>
                    <field name="name"/>
                    <field name="code"/>
                    <group expand="0" string="Group By">
                        <filter string="固定资产名称" domain="[]" context="{'group_by':'name'}"/>
                        <filter string="会计期间" domain="[]" context="{'group_by':'period_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <!--固定资产折旧-->
        <record id="create_depreciation_wizard_form" model="ir.ui.view">
            <field name="name">create.depreciation.wizard.form</field>
            <field name="model">create.depreciation.wizard</field>
            <field name="arch" type="xml">
            	<form>
            		<group>
                        <group>
                            <field name="date" style="width: 30%%"/>
                            <field name="period_id"  style="width: 30%%"/>
                        </group>
                    </group>
                    <footer>
                        <button name="create_depreciation"  string="确认并查看折旧明细表" type="object" class="oe_highlight"/>
                        或者
                        <button string="取消" class="oe_link" special="cancel"/>
                    </footer>
            	</form>
            </field>
        </record>

		<!--固定资产分类tree-->
        <record id='asset.category_tree' model='ir.ui.view'>
			<field name='name'>asset.category.tree</field>
			<field name='model'>asset.category</field>
			<field name='arch' type='xml'>
				<tree string='固定资产分类'>
					<field name='name'/>
					<field name='account_accumulated_depreciation'/>
					<field name='account_asset'/>
					<field name='account_depreciation'/>
                    <field name="clear_account_id" />
                    <field name='depreciation_number'/>
					<field name='depreciation_value'/>
					<field name='clean_income'/>
                    <field name='clean_costs'/>
                    <field name='active' invisible='1'/>
				</tree>
			</field>
		</record>

        <!--固定资产分类form-->
        <record id='asset.category_form' model='ir.ui.view'>
			<field name='name'>asset.category.form</field>
			<field name='model'>asset.category</field>
			<field name='arch' type='xml'>
				<form string="固定资产">
                    <group>
                        <group>
                            <field name='name'/>
                        </group>
                        <group>
                            <field name='is_depreciation'/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name='account_asset' required="1" options="{'no_open': True, 'no_create': True}"/>
                            <field name='asset_other_money_pay_category' options="{'no_open': True, 'no_create': True}"/>
                            <field name='clean_income' options="{'no_open': True, 'no_create': True}"/>
                            <field name='clean_costs' options="{'no_open': True, 'no_create': True}"/>
                            <field name="clear_account_id" options="{'no_open': True, 'no_create': True}"/>
                            <field name='active'/>
                        </group>
                        <group>
                            <field name='account_accumulated_depreciation' attrs="{'required':[('is_depreciation', '=', False)], 'invisible': [('is_depreciation', '!=', False)]}" options="{'no_open': True, 'no_create': True}"/>
                            <field name='account_depreciation' attrs="{'required':[('is_depreciation', '=', False)], 'invisible': [('is_depreciation', '!=', False)]}" options="{'no_open': True, 'no_create': True}"/>
                            <field name='depreciation_number' attrs="{'required':[('is_depreciation', '=', False)], 'invisible': [('is_depreciation', '!=', False)]}"/>
                            <field name='depreciation_value' attrs="{'required':[('is_depreciation', '=', False)], 'invisible': [('is_depreciation', '!=', False)]}"/>
                        </group>
                    </group>
                </form>
			</field>
		</record>

        <record id="init_asset_form" model="ir.ui.view">
            <field name="name">init.asset.form</field>
            <field name="model">voucher</field>
            <field name="inherit_id" ref="finance.voucher_form"/>
            <field name="arch" type="xml">
                <button  name="voucher_done" position="after">
                	<field name='is_init' invisible='1'/>
                    <button name='init_asset' string="引入固定资产" type="object" class="oe_highlight" attrs="{'invisible': ['|',('is_init', '=', False), ('state', '=', 'done')]}"/>
                </button>
            </field>
        </record>

		<!--固定资产不可以直接凭证tree-->
        <record id='asset.asset_account_tree' model='ir.ui.view'>
			<field name='name'>asset.account.tree</field>
			<field name='model'>asset.account</field>
			<field name='arch' type='xml'>
				<tree string='固定资产贷方科目维护' editable="TOP">
					<field name='name'/>
				</tree>
			</field>
		</record>

        <!--固定资产贷方科目设置-->
        <record id='asset.asset_account_tree' model='ir.ui.view'>
			<field name='name'>asset.account.tree</field>
			<field name='model'>asset.account</field>
			<field name='arch' type='xml'>
				<tree string='固定资产贷方科目维护' editable="TOP">
					<field name='name'/>
				</tree>
			</field>
		</record>


	</data>
</openerp>